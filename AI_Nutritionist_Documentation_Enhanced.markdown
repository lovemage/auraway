# AI 營養師功能設計文檔（增強版）

本文檔詳細記錄了 Auraway Shop 網站中「AI 營養師」功能的設計與實作邏輯，模擬專業營養師的問診流程，提供精準的健康分析與產品推薦。

---

## 第一部分：對話流程與問卷設計

AI 營養師透過模擬專業營養師的問診方式，使用溫暖且個人化的語氣，逐步收集用戶的健康資訊。問卷設計更全面，涵蓋生物、心理、飲食和生活方式等多維度問題，並根據用戶回應動態調整後續問題，確保精準性與流暢性。

### 對話原則
- **專業性**：使用營養學術語（如「腸道微生物群」「能量代謝」），但以淺顯語言解釋。
- **個人化**：根據用戶回答調整語氣（如對壓力大的用戶表達同理心）。
- **簡潔性**：每輪問題控制在 1-2 句，避免用戶疲勞。
- **引導性**：在問題間添加過渡語（如「感謝您的分享！接下來…」），模擬真人對話。

### 問題列表

**問題 1: 生理性別與懷孕狀況**
- **觸發文案**: `您好！我是您的專屬 AI 營養師，很高興為您提供個人化的健康建議。請問您的生理性別是？若為女性，是否正在懷孕或哺乳？`
- **選項**:
  - 男性
  - 女性（非懷孕/哺乳）
  - 女性（懷孕或哺乳）

**問題 2: 年齡與健康背景**
- **觸發文案**: `感謝您的回答！請問您的年齡區間，以及是否有慢性疾病（如糖尿病、高血壓）？`
- **選項**:
  - 年齡：18-29 / 30-49 / 50-65 / 65 歲以上
  - 慢性疾病：無 / 有（請簡述，如高血壓）

**問題 3: 身高與體重**
- **觸發文案**: `了解了！為了更精準地評估您的健康狀況，請提供您的身高（公分）和體重（公斤）。`
- **輸入**:
  - 身高：開放式數值（cm）
  - 體重：開放式數值（kg）
- **動態提示**：若 BMI（體重/身高²）超出正常範圍（18.5-24.9），後續問題將聚焦體重管理。

**問題 4: 飲食模式**
- **觸發文案**: `您的飲食習慣對健康影響很大。請問您目前的飲食模式是？`
- **選項**:
  - 均衡飲食（規律三餐，包含蔬果、蛋白質、全穀類）
  - 外食為主（高油、高鹽或加工食品）
  - 素食/純素（無肉或無動物製品）
  - 低碳水化合物/生酮飲食
  - 其他（請簡述）

**問題 5: 每日水分攝取**
- **觸發文案**: `水分攝取也很重要！您平均每天喝多少水？`
- **選項**:
  - 少於 1 公升
  - 1-2 公升
  - 2 公升以上

**問題 6: 運動習慣**
- **觸發文案**: `運動能提升整體健康。請問您每週的運動頻率和類型是？`
- **選項**:
  - 幾乎不運動
  - 輕度運動（散步、瑜伽，1-2 次/週）
  - 中度運動（慢跑、健身，3-5 次/週）
  - 高強度運動（重訓、競技運動，5 次以上/週）

**問題 7: 睡眠與壓力**
- **觸發文案**: `睡眠和壓力對健康影響深遠。請問您的平均睡眠時數和壓力水平？`
- **選項**:
  - 睡眠：少於 6 小時 / 6-8 小時 / 8 小時以上
  - 壓力：低（輕鬆）/ 中（偶爾緊張）/ 高（持續壓力）

**問題 8: 特殊飲食需求**
- **觸發文案**: `感謝您的耐心回答！請問您是否有食物過敏或特殊飲食限制？`
- **選項**:
  - 無
  - 有（如乳糖不耐、麩質過敏，請簡述）

**問題 9: 健康目標（可複選）**
- **觸發文案**: `最後，請告訴我您希望優先改善的健康目標是什麼？（可多選）`
- **選項**:
  - 提升能量與活力
  - 改善睡眠品質
  - 促進腸道健康
  - 體重管理（減重/增肌）
  - 穩定情緒與壓力
  - 增強免疫力
  - 改善皮膚與頭髮
  - 支持心血管健康
  - 緩解關節與肌肉不適
  - 保護視力
  - 提升認知功能（如記憶力）

**問題 10: 當前補充劑使用**
- **觸發文案**: `為了避免重複推薦，您目前是否正在服用保健食品或藥物？`
- **選項**:
  - 無
  - 有（請簡述，如維生素 D、降壓藥）

---

## 第二部分：後端分析與推薦邏輯

後端分析引擎（`generateAnalysis` 函數）基於多維度交叉分析，結合 BMI、飲食模式、運動量等數據，生成精準的健康建議。建議內容引用營養學原理，並以科學依據支持產品推薦。

### 分析建議規則庫

1. **BMI 與體重管理**:
   - **條件**: BMI < 18.5（過輕）
   - **建議**: `您的 BMI 偏低，可能存在營養吸收不足或代謝問題。建議增加高蛋白食物（如雞蛋、豆類）並補充綜合維生素，促進健康增重。`
   - **條件**: BMI 25-29.9（過重）或 ≥ 30（肥胖）
   - **建議**: `您的 BMI 顯示超重/肥胖，可能增加心血管風險。建議結合低 GI 飲食和適度運動，輔以燃脂補充劑如綠茶萃取或苦瓜胜肽。`

2. **睡眠與壓力交互分析**:
   - **條件**: 睡眠 < 6 小時 **且** 壓力 = 高
   - **建議**: `長期睡眠不足和高壓力可能擾亂神經內分泌系統，影響免疫與情緒。建議優先調整作息，並考慮補充 GABA 或鎂，促進放鬆與睡眠。`

3. **飲食與腸道健康**:
   - **條件**: 飲食 = 外食為主 **且** 健康目標包含腸道健康
   - **建議**: `外食飲食易導致腸道微生物群失衡，可能引發消化問題或免疫下降。建議每日補充益生菌（如乳酸菌）並增加膳食纖維攝取。`

4. **運動與能量需求**:
   - **條件**: 運動 = 高強度 **且** 健康目標包含提升能量
   - **建議**: `高強度運動增加能量代謝需求，B 群維生素和輔酶 Q10 是支持線粒體功能的重要營養素，有助於提升耐力與恢復。`

5. **年齡與慢性病風險**:
   - **條件**: 年齡 ≥ 50 **且** 有慢性疾病（如高血壓）
   - **建議**: `隨著年齡增長，慢性病風險上升，建議關注心血管健康。Omega-3 脂肪酸和輔酶 Q10 可支持心臟功能，同時定期監測血壓。`

6. **特殊飲食需求**:
   - **條件**: 飲食 = 素食/純素 **且** 健康目標包含提升能量
   - **建議**: `素食可能缺乏維生素 B12 和鐵，易導致疲倦。建議補充 B12 及植物性鐵劑，並搭配維生素 C 提升吸收率。`

7. **水分攝取不足**:
   - **條件**: 水分 < 1 公升
   - **建議**: `水分攝取不足可能影響代謝與腎臟健康。建議每日飲用 1.5-2 公升水，並可添加電解質補充劑以維持體液平衡。`

8. **皮膚與美容需求**:
   - **條件**: 健康目標包含改善皮膚
   - **建議**: `皮膚健康與抗氧化能力密切相關。膠原蛋白、維生素 C 和 E 能促進膠原合成，改善膚質與彈性。`

9. **免疫力提升**:
   - **條件**: 健康目標包含增強免疫力 **且** 壓力 = 高
   - **建議**: `高壓力可能抑制免疫功能，維生素 D、鋅和益生菌是增強免疫系統的關鍵營養素，建議長期補充。`

10. **預設建議**:
    - **條件**: 未觸發特定規則
    - **建議**: `您的健康狀況整體良好！建議維持均衡飲食與規律運動，並根據個人需求補充基礎營養素（如維生素 D、B 群），鞏固健康基礎。`

### 產品推薦規則

推薦分為**顯性推薦**（直接對應健康目標）和**隱性推薦**（基於生活習慣與健康數據推斷）。所有推薦產品均使用資料庫中的官方全名，確保推薦準確性。

- **顯性推薦**:
  - `提升能量與活力`: '美國-代謝B群Plus', '美國-黑馬卡精氨酸男性活力膠囊', '肝精', '美國-綜合維生素軟糖'
  - `改善睡眠品質`: '美國-夜舒眠GABA'
  - `促進腸道健康`: '波森莓益生菌', '酵纖凍', '原生-淨暢酵素錠', '美國-固益清', '青之酵素果凍'
  - `體重管理（減重/增肌）`: '美國-燃纖脂專業燃脂膠囊', '美國-苦瓜胜肽', '日本-孅淨一杯'
  - `穩定情緒與壓力`: '美國-夜舒眠GABA', '日本-平安錠'
  - `增強免疫力`: '加拿大-維生素D3液劑15ml', '【新上市】維生素C+酵母鋅', '美國-綜合維生素軟糖'
  - `改善皮膚與頭髮`: '美妍飲', '膠原蛋白胜肽', '珍珠露', '日本蜂王乳'
  - `支持心血管健康`: '日本-Q10', '日本-蚓激酶', '加拿大-薑黃魚油', '原生-高濃度魚油'
  - `緩解關節與肌肉不適`: '美國-關舒活關節保健膠囊', '美國-檸檬酸鈣粉'
  - `保護視力`: '日本-葉黃素', '藍莓口味葉黃素口嚼錠'
  - `提升認知功能（如記憶力）`: '加拿大-薑黃魚油', '原生-高濃度魚油'

- **隱性推薦**:
  - **條件**: `高壓&睡眠差` → **推薦**: `美國-夜舒眠GABA`
  - **條件**: `飲食油膩&腸道問題` → **推薦**: `波森莓益生菌`, `酵纖凍`, `原生-淨暢酵素錠`, `美國-固益清`
  - **條件**: `高強度運動&關節` → **推薦**: `美國-關舒活關節保健膠囊`, `膠原蛋白胜肽`
  - **條件**: `年長&心血管` → **推薦**: `日本-Q10`, `日本-蚓激酶`, `原生-高濃度魚油`
  - **條件**: `素食&能量` → **推薦**: `美國-代謝B群Plus`

- **避免重複推薦**:
  - 若用戶已服用某補充劑（如維生素 D），從推薦清單中移除相關產品，並提示：「您已服用維生素 D，建議維持劑量並注意均衡飲食。」

- **科學依據**:
  - 每項推薦附上簡短說明，如：「GABA 透過調節神經傳導物質促進放鬆，已被多項研究證實有助於改善入睡時間（來源：Journal of Clinical Neurology, 2018）。」

---

## 第三部分：API 設計

### 端點 (Endpoint)
- **方法**: `POST`
- **路徑**: `/api/ai-nutritionist/recommend`

### 請求主體 (Request Body)
前端發送的 JSON 結構，包含所有問卷答案：

```json
{
  "gender": "女性",
  "pregnancy": "非懷孕/哺乳",
  "age": "30-49",
  "chronicConditions": "無",
  "height": 165,
  "weight": 70,
  "diet": "外食為主",
  "waterIntake": "1-2 公升",
  "exercise": "輕度運動",
  "sleep": "少於6小時",
  "stress": "高",
  "allergies": "無",
  "healthGoals": ["提升能量", "改善睡眠", "腸道健康"],
  "supplements": "維生素 D"
}
```

### 回應主體 (Response Body)
後端回傳的 JSON 結構，包含分析建議、推薦產品和科學依據：

```json
{
  "analysis": [
    "您的 BMI 為 25.7，屬於超重範圍，可能增加心血管風險。建議結合低 GI 飲食和適度運動，逐步改善體重。",
    "睡眠不足（<6 小時）和高壓力可能影響神經內分泌系統，導致疲倦和情緒波動。GABA 和鎂可促進放鬆，改善睡眠品質。",
    "外食為主可能導致腸道微生物群失衡，影響消化與免疫。益生菌和膳食纖維有助於恢復腸道健康。"
  ],
  "products": [
    {
      "_id": "60c72b0f9b1d8e001c8e4a9e",
      "name": "美國-夜舒眠 GABA",
      "images": ["images/美國-夜舒眠GABA/image1.jpg"],
      "benefits": "促進神經放鬆，改善入睡時間",
      "evidence": "GABA 透過調節神經傳導物質促進放鬆（Journal of Clinical Neurology, 2018）。"
    },
    {
      "_id": "60c72b0f9b1d8e001c8e4a9f",
      "name": "波森莓益生菌",
      "images": ["images/波森莓益生菌/image1.jpg"],
      "benefits": "調節腸道菌群，提升消化功能",
      "evidence": "益生菌可改善腸道屏障功能（Gut Microbes, 2020）。"
    },
    {
      "_id": "60c72b0f9b1d8e001c8e4aa0",
      "name": "鎂複合物",
      "images": ["images/鎂複合物/image1.jpg"],
      "benefits": "緩解壓力與肌肉緊張",
      "evidence": "鎂參與神經肌肉放鬆（Nutrients, 2017）。"
    }
  ],
  "disclaimer": "以上建議基於您的問卷回應，僅供參考。如有慢性疾病或正在服藥，請諮詢醫師。"
}
```

---

## 第四部分：實現注意事項

1. **法規合規**：
   - 確保建議符合台灣《食品安全衛生管理法》，避免醫療診斷或誇大功效。
   - 在回應中添加免責聲明，提示用戶諮詢專業人士。

2. **用戶體驗**：
   - 問卷進度條：顯示當前問題進度（如「3/10」），減少用戶焦慮。
   - 動態分支：根據用戶回答跳過無關問題（如無慢性病則跳過相關細節）。
   - 多語言支援：提供繁體中文與英文版本，適應不同用戶。

3. **技術優化**：
   - **快取**：將熱門健康目標的推薦結果快取至 Redis，減少 API 延遲。
   - **錯誤處理**：若用戶輸入無效數據（如身高 0 cm），返回友好提示。
   - **日誌**：記錄用戶問卷與推薦結果，用於後續分析與模型優化。

4. **與前端整合**：
   - 前端應使用 React 狀態管理（如 Redux）儲存問卷進度，支援中途暫停。
   - 彈出視窗（Modal）應支援滾動，顯示長篇分析與產品圖片。

5. **AI 模型增強**：
   - 目前規則基於固定邏輯，未來可整合 Grok 或 Mistral 模型，生成更自然的對話回應。
   - 例：將分析建議輸入 Grok，生成更流暢的語句，如「您似乎正處於高壓狀態，試試放鬆身心的 GABA 吧！」

---

## 第五部分：未來改進方向

1. **機器學習優化**：
   - 收集用戶問卷數據，訓練分類模型預測健康需求，提高推薦準確率。
   - 使用 NLP 分析開放式回答（如「我容易便秘」），動態生成建議。

2. **個人化追蹤**：
   - 支援用戶帳戶，記錄歷史問卷與推薦，定期更新健康建議。
   - 提供飲食日誌功能，結合 AI 分析每日營養攝取。

3. **擴展健康數據**：
   - 整合穿戴式設備數據（如心率、步數），提供更精準的運動與睡眠建議。
   - 與醫療 API 連動，獲取用戶血檢數據（如維生素 D 水平）。

4. **互動性提升**：
   - 加入語音輸入功能，模擬真人營養師對話。
   - 提供視覺化報告（如營養攝取圓環圖），增強用戶參與度。